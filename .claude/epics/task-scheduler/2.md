---
name: Core Scheduler Framework
status: closed
created: 2026-01-17T09:00:24Z
updated: 2026-01-17T09:08:42Z
github: https://github.com/ebergstedt/ccpm-poc/issues/2
last_sync: 2026-01-17T10:09:08Z
depends_on: []
parallel: false
conflicts_with: []
---

# Task: Core Scheduler Framework

## Description

Build the foundational scheduler service skeleton that defines the core architecture. This includes the Predictor interface, Worker Registry, Dispatcher, and round-robin fallback mechanism. This task establishes the structure that all other tasks will build upon.

## Acceptance Criteria

- [ ] Scheduler service starts and connects to Redis Streams
- [ ] `Predictor` interface defined with `predict(task)` method
- [ ] `WorkerRegistry` class tracks worker availability
- [ ] `Dispatcher` dispatches tasks to selected workers
- [ ] Round-robin fallback works when no predictions available
- [ ] Circuit breaker triggers fallback after 3 consecutive failures
- [ ] Service gracefully handles startup/shutdown

## Technical Details

### Files to Create
- `src/scheduler/index.ts` - Service entry point
- `src/scheduler/interfaces/predictor.ts` - Predictor interface
- `src/scheduler/interfaces/types.ts` - Core types (TaskPrediction, WorkerState, SchedulingDecision)
- `src/scheduler/registry/worker-registry.ts` - Worker state management
- `src/scheduler/dispatcher/dispatcher.ts` - Task dispatch logic
- `src/scheduler/fallback/round-robin.ts` - Fallback scheduler

### Key Implementation Notes
- Use dependency injection for predictor (allows swapping implementations)
- WorkerRegistry uses Map<workerId, WorkerState> for O(1) lookups
- Dispatcher consumes from Redis Streams, dispatches via Redis publish
- Circuit breaker: simple counter with reset on success

### Configuration
```typescript
interface SchedulerConfig {
  redisUrl: string;
  fallbackThreshold: number; // Default: 3
  heartbeatTimeoutMs: number; // Default: 30000
}
```

## Dependencies

- [ ] Redis available for queue operations
- [ ] TypeScript project structure initialized

## Effort Estimate

- Size: M
- Hours: 8-12
- Parallel: false (foundation for other tasks)

## Definition of Done

- [ ] Code implemented with TypeScript strict mode
- [ ] Unit tests for WorkerRegistry and Dispatcher
- [ ] Integration test: service starts, consumes task, dispatches via round-robin
- [ ] README documents service startup and configuration
- [ ] Code reviewed
