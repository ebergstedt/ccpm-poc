---
name: Heuristic Predictor
status: open
created: 2026-01-17T09:00:24Z
updated: 2026-01-17T09:08:42Z
github: https://github.com/ebergstedt/ccpm-poc/issues/3
depends_on: [2]
parallel: false
conflicts_with: []
---

# Task: Heuristic Predictor

## Description

Implement the `HeuristicPredictor` class that predicts task execution duration using exponential moving averages (EMA). Predictions are kept in-memory for fast access with periodic snapshots to Redis for warm restarts.

## Acceptance Criteria

- [ ] `HeuristicPredictor` implements `Predictor` interface
- [ ] EMA calculation with configurable α (default: 0.3)
- [ ] Per-task-type prediction tracking
- [ ] Fallback to 5000ms for unknown task types
- [ ] Confidence score based on sample count
- [ ] Redis persistence: save snapshots every N updates
- [ ] Warm restart: load predictions from Redis on startup
- [ ] Cold start: use sensible defaults, log warning

## Technical Details

### Files to Create
- `src/scheduler/predictor/heuristic-predictor.ts` - Main implementation
- `src/scheduler/predictor/ema.ts` - EMA calculation utilities
- `src/scheduler/predictor/persistence.ts` - Redis snapshot logic

### EMA Formula
```typescript
// newEMA = α * actual + (1-α) * previousEMA
function updateEMA(current: number, actual: number, alpha: number): number {
  return alpha * actual + (1 - alpha) * current;
}
```

### Confidence Calculation
```typescript
// Confidence increases with sample count, caps at 1.0
confidence = Math.min(1.0, sampleCount / 100);
```

### Data Structure
```typescript
interface PredictionState {
  taskType: string;
  ema: number;
  sampleCount: number;
  lastUpdated: Date;
}
```

### Configuration
```typescript
interface PredictorConfig {
  alpha: number; // Default: 0.3
  defaultDurationMs: number; // Default: 5000
  snapshotInterval: number; // Default: 100 updates
  redisKey: string; // Default: "scheduler:predictions"
}
```

## Dependencies

- [ ] Task 2: Core Scheduler Framework (Predictor interface)
- [ ] Redis for persistence

## Effort Estimate

- Size: S
- Hours: 4-6
- Parallel: false (depends on 2)

## Definition of Done

- [ ] Code implemented
- [ ] Unit tests for EMA calculation and confidence scoring
- [ ] Integration test: predictions persist and restore from Redis
- [ ] Performance test: predict() < 1ms
- [ ] Code reviewed
