---
name: API & Controls
status: open
created: 2026-01-17T09:00:24Z
updated: 2026-01-17T09:08:42Z
github: https://github.com/ebergstedt/ccpm-poc/issues/8
depends_on: [2]
parallel: true
conflicts_with: []
---

# Task: API & Controls

## Description

Implement REST API endpoints for scheduler status, configuration, and manual controls. This enables operators to monitor the scheduler, adjust settings at runtime, and override predictions when needed.

## Acceptance Criteria

- [ ] GET `/scheduler/status` - Overall scheduler health and stats
- [ ] GET `/scheduler/workers` - List workers with current state
- [ ] GET `/scheduler/predictions` - Current prediction states
- [ ] PUT `/scheduler/config` - Update runtime configuration
- [ ] POST `/scheduler/override` - Manual worker selection for task
- [ ] DELETE `/scheduler/predictions/{taskType}` - Reset predictions for type
- [ ] All endpoints authenticated and rate-limited

## Technical Details

### Files to Create
- `src/scheduler/api/routes.ts` - Express route definitions
- `src/scheduler/api/handlers.ts` - Request handlers
- `src/scheduler/api/middleware.ts` - Auth and rate limiting

### Endpoint Specifications

**GET /scheduler/status**
```json
{
  "status": "healthy",
  "uptime": 3600,
  "workers": { "healthy": 10, "degraded": 2, "unhealthy": 1 },
  "predictions": { "taskTypes": 15, "avgConfidence": 0.82 },
  "decisions": { "total": 50000, "fallbackRate": 0.02 },
  "latency": { "p50": 2, "p99": 8 }
}
```

**GET /scheduler/workers**
```json
{
  "workers": [
    {
      "id": "worker-1",
      "status": "healthy",
      "load": 0.65,
      "queueDepth": 3,
      "lastHeartbeat": "2026-01-17T09:00:00Z"
    }
  ]
}
```

**PUT /scheduler/config**
```json
{
  "weights": { "wait": 0.5, "load": 0.3, "priority": 0.2 },
  "fallbackThreshold": 5,
  "heartbeatTimeoutMs": 45000
}
```

**POST /scheduler/override**
```json
{
  "taskId": "task-123",
  "workerId": "worker-5",
  "reason": "Manual override for debugging"
}
```

### Middleware
- API key authentication (header: `X-Scheduler-Key`)
- Rate limiting: 100 req/min per key
- Request logging with correlation ID

## Dependencies

- [ ] Task 2: Core Scheduler Framework (service structure)
- [ ] Express.js (or similar) for HTTP server

## Effort Estimate

- Size: S
- Hours: 4-6
- Parallel: true (can proceed after 2, independent of other tasks)

## Definition of Done

- [ ] Code implemented
- [ ] All endpoints documented in OpenAPI spec
- [ ] Unit tests for handlers
- [ ] Integration test: config update affects scheduling
- [ ] Rate limiting verified
- [ ] Code reviewed
