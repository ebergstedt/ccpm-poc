---
name: Integration & Testing
status: closed
created: 2026-01-17T09:00:24Z
updated: 2026-01-17T09:08:42Z
github: https://github.com/ebergstedt/ccpm-poc/issues/9
last_sync: 2026-01-17T10:09:08Z
depends_on: [5, 6, 7, 8]
parallel: false
conflicts_with: []
---

# Task: Integration & Testing

## Description

Comprehensive end-to-end testing, shadow mode implementation, and performance benchmarks. Validates that the complete scheduler meets all success criteria before production deployment.

## Acceptance Criteria

- [ ] E2E test: task flows through entire scheduling pipeline
- [ ] Shadow mode: log predictive decisions without affecting dispatch
- [ ] Performance benchmark: verify < 10ms p99 at 100 tasks/sec
- [ ] Comparison test: predictive vs round-robin performance
- [ ] Load test: sustain 100 tasks/sec for 10 minutes
- [ ] Chaos test: verify fallback on prediction failures
- [ ] All quality gates pass

## Technical Details

### Files to Create
- `src/scheduler/testing/e2e.test.ts` - End-to-end tests
- `src/scheduler/testing/benchmark.ts` - Performance benchmarks
- `src/scheduler/testing/shadow-mode.ts` - Shadow mode implementation
- `src/scheduler/testing/chaos.ts` - Failure injection tests

### E2E Test Scenarios
1. **Happy path**: Task submitted → scheduled → completed → prediction updated
2. **Cold start**: No predictions → fallback used → predictions learned
3. **Worker failure**: Worker goes unhealthy → excluded from scheduling
4. **High load**: Many tasks → even distribution across workers
5. **Priority handling**: High priority tasks scheduled faster

### Shadow Mode
```typescript
class ShadowScheduler {
  // Runs predictive scheduling without dispatching
  // Logs what it would have done
  // Compares to actual round-robin decisions
  async shadow(task: Task): Promise<ShadowResult> {
    const predictive = await this.predictiveScheduler.select(task);
    const actual = this.actualDispatch; // From real scheduler
    return {
      predictive,
      actual,
      match: predictive.workerId === actual.workerId,
      scoreDiff: predictive.score - actual.score
    };
  }
}
```

### Performance Benchmark
```typescript
// Target: < 10ms p99 at 100 tasks/sec
interface BenchmarkResult {
  throughput: number; // tasks/sec
  latency: {
    p50: number;
    p90: number;
    p99: number;
    max: number;
  };
  memoryMB: number;
  success: boolean; // Meets targets?
}
```

### Quality Gates Checklist
- [ ] Unit test coverage > 80%
- [ ] All integration tests pass
- [ ] p99 latency < 10ms
- [ ] Throughput >= 100 tasks/sec
- [ ] Fallback triggers correctly
- [ ] Shadow mode shows improvement over round-robin
- [ ] No memory leaks in 10-minute load test

### Chaos Tests
1. Force prediction failures → verify fallback
2. Kill ClickHouse → verify scheduling continues
3. Redis slowdown → verify graceful degradation
4. Worker heartbeat delay → verify health transitions

## Dependencies

- [ ] Task 5: Multi-Objective Scorer (complete scheduling logic)
- [ ] Task 6: Metrics & Observability (metrics available)
- [ ] Task 7: Feedback Loop (learning verified)
- [ ] Task 8: API & Controls (status endpoints)

## Effort Estimate

- Size: M
- Hours: 8-12
- Parallel: false (requires all other tasks complete)

## Definition of Done

- [ ] All E2E tests pass
- [ ] Performance benchmarks meet targets
- [ ] Shadow mode comparison documented
- [ ] Chaos tests pass
- [ ] Quality gates verified
- [ ] Ready for production deployment
- [ ] Code reviewed
